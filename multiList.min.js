!function(t){t.fn.multiList=function(i){var e,n,a,l,s=this,d=[],o=this,c={orientation:"vertical",itemActions:!1,icon:!1,placeholder:"Select options"},u=t.extend({},c,i);u.orientation=u.orientation.charAt(0).toUpperCase(),s.initOptionsValues=function(){var i=1;o.find("option").each(function(){t(this).attr("data-multiList-id",i),i++})},s.createInterface=function(){var i="";i+='<div id="'+l+'" class="multiListContainer">',i+='<div class="multiListNestable multiList'+u.orientation+' dd"><ol class="dd-list clearfix"></ol></div>',i+='<div class="multiListSelect2"></div>',i+="</div>",t(this).before(i),e=t("#"+l),n=e.find(".multiListNestable"),a=e.find(".multiListSelect2"),a.append(o)},s.getSelectedValues=function(){d=[],o.find("option:selected").each(function(){d.push({id:t(this).attr("data-multiList-id"),name:t(this).text(),weight:t(this).attr("data-order"),value:t(this).val()})}),o.find("option").not("option:selected").attr("data-order",parseInt(d.length+1)),d.sort(function(t,i){return parseInt(t.weight)-parseInt(i.weight)})},s.getMultilistItem=function(i){return t.grep(d,function(t){return t.id==i})[0]},s.execNestable=function(){n.find(".dd-list").html(""),d.length>0&&(t.each(d,function(i,e){var a='<li class="dd-item" data-id="'+e.id+'">';a+='<div class="unselectNestable">X</div>',a+='<ul class="dd-multiListActions clearfix">',t.each(u.itemActions,function(t,i){a+='<li class="dd-multiList-action-'+i.id+'" data-action-id="'+i.id+'">',a+=i.html,a+="</li>"}),a+="</ul>",a+='<div class="dd-handle">',a+='<div class="dd-multiListIcon">',u.icon&&(a+=u.icon),a+="</div>",a+=e.name+"</div>",a+="</li>",n.find(".dd-list").append(a),o.find('option[data-multiList-id="'+e.id+'"]').attr("data-order",i)}),n.find(".unselectNestable").on("click",function(i){var e=t(this).parent().attr("data-id");o.find('option[data-multiList-id="'+e+'"]').attr("selected",!1),t(this).parent().remove(),i.stopPropagation()}));var i;i="V"===u.orientation?"multiListDragel":"multiListDragel multiList"+u.orientation,n.nestable({dragClass:i,maxDepth:1,group:l,callback:function(){var i=n.nestable("serialize");t.each(i,function(t,i){o.find('option[data-multiList-id="'+i.id+'"]').attr("data-order",t)})}})},s.execSelect2=function(){o.select2({tags:"true",placeholder:u.placeholder})},s.reloadMultiList=function(){s.initOptionsValues(),s.getSelectedValues(),s.execNestable(),s.multiListBinds()},s.multiListBinds=function(){o.on("change",function(){s.reloadMultiList()}),n.on("click",function(){o.select2("open")}),u.itemActions&&n.find(".dd-multiListActions li").on("click",function(i){var e=t(i.currentTarget).attr("data-action-id");t.each(u.itemActions,function(n,a){e===a.id&&a.action(s.getMultilistItem(t(i.currentTarget).closest("li.dd-item").attr("data-id")))})})},s.init=function(){"undefined"!=typeof multiListCount?multiListCount++:multiListCount=1,l="multiListId-"+multiListCount,s.initOptionsValues(),s.getSelectedValues(),s.createInterface(),s.execSelect2(),s.execNestable(),s.multiListBinds()},s.init()},t.fn.multiMultiList=function(i){t(this).each(function(){t(this).multiList(i)})}}(jQuery);
