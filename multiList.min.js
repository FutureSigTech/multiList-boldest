!function(t){t.fn.multiList=function(i){var e,n,a,s,l=this,d=[],o=this,c={orientation:"vertical",itemActions:!1,itemImage:!1,icon:!1,placeholder:"Select options"},u=t.extend({},c,i);u.orientation=u.orientation.charAt(0).toUpperCase(),u.itemImage&&(u.orientation="H"),l.initOptionsValues=function(){var i=1;o.find("option").each(function(){t(this).attr("data-multiList-id",i),i++})},l.createInterface=function(){var i="";u.itemImage&&(i="multiListImages");var l="";l+='<div id="'+s+'" class="multiListContainer">',l+='<div class="multiListNestable '+i+" multiList"+u.orientation+' dd"><ol class="dd-list clearfix"></ol></div>',l+='<div class="multiListSelect2"></div>',l+="</div>",t(this).before(l),e=t("#"+s),n=e.find(".multiListNestable"),a=e.find(".multiListSelect2"),a.append(o)},l.getSelectedValues=function(){d=[],o.find("option:selected").each(function(){var i={id:t(this).attr("data-multiList-id"),name:t(this).text(),weight:t(this).attr("data-order"),value:t(this).val()};u.itemImage&&(i.image=t(this).attr("data-image")),d.push(i)}),o.find("option").not("option:selected").attr("data-order",parseInt(d.length+1)),d.sort(function(t,i){return parseInt(t.weight)-parseInt(i.weight)})},l.getMultilistItem=function(i){return t.grep(d,function(t){return t.id==i})[0]},l.execNestable=function(){n.find(".dd-list").html(""),d.length>0&&(t.each(d,function(i,e){var a='<li class="dd-item" data-id="'+e.id+'">';a+='<div class="unselectNestable">X</div>',u.itemActions&&(a+='<ul class="dd-multiListActions clearfix">',t.each(u.itemActions,function(t,i){a+='<li class="dd-multiList-action-'+i.id+'" data-action-id="'+i.id+'">',a+=i.html,a+="</li>"}),a+="</ul>"),a+='<div class="dd-handle">',a+='<div class="dd-multiListIcon">',u.icon&&(a+=u.icon),a+="</div>",u.itemImage&&(a+='<div class="multiListImage"><img class="img-responsive" src="'+e.image+'"></div>'),a+='<div class="multiListText">'+e.name+"</div>",a+="</div>",a+="</li>",n.find(".dd-list").append(a),o.find('option[data-multiList-id="'+e.id+'"]').attr("data-order",i)}),n.find(".unselectNestable").on("click",function(i){var e=t(this).parent().attr("data-id");o.find('option[data-multiList-id="'+e+'"]').attr("selected",!1),t(this).parent().remove(),i.stopPropagation()}));var i="";u.itemImage&&(i="multiListImages");var e;e="V"===u.orientation?s+" multiListDragel "+i:s+" multiListDragel "+i+" multiList"+u.orientation,n.nestable({dragClass:e,maxDepth:1,group:s,callback:function(){var i=n.nestable("serialize");t.each(i,function(t,i){o.find('option[data-multiList-id="'+i.id+'"]').attr("data-order",t)})}})},l.execSelect2=function(){o.select2({tags:"true",placeholder:u.placeholder})},l.reloadMultiList=function(){l.initOptionsValues(),l.getSelectedValues(),l.execNestable(),l.multiListBinds()},l.multiListBinds=function(){o.on("change",function(){l.reloadMultiList()}),n.on("click",function(){o.select2("open")}),u.itemActions&&n.find(".dd-multiListActions li").on("click",function(i){var e=t(i.currentTarget).attr("data-action-id");t.each(u.itemActions,function(n,a){e===a.id&&a.action(l.getMultilistItem(t(i.currentTarget).closest("li.dd-item").attr("data-id")))})})},l.init=function(){"undefined"!=typeof multiListCount?multiListCount++:multiListCount=1,s="multiListId-"+multiListCount,l.initOptionsValues(),l.getSelectedValues(),l.createInterface(),l.execSelect2(),l.execNestable(),l.multiListBinds()},l.init()},t.fn.multiMultiList=function(i){t(this).each(function(){t(this).multiList(i)})}}(jQuery);
