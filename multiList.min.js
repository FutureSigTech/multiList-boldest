!function(a){a.fn.multiList=function(b){var d,e,f,g,c=this,h=[],i=this,j={orientation:"vertical",itemActions:!1,itemImage:!1,icon:!1,placeholder:"Select options"},k=a.extend({},j,b);k.orientation=k.orientation.charAt(0).toUpperCase(),k.itemImage&&(k.orientation="H"),c.initOptionsValues=function(){var b=1;i.find("option").each(function(c){a(this).attr("data-multiList-id",b),b++})},c.createInterface=function(){var b="";k.itemImage&&(b="multiListImages");var c="";c+='<div id="'+g+'" class="multiListContainer">',c+='<div class="multiListNestable '+b+" multiList"+k.orientation+' dd"><ol class="dd-list clearfix"></ol></div>',c+='<div class="multiListSelect2"></div>',c+="</div>",a(this).before(c),d=a("#"+g),e=d.find(".multiListNestable"),f=d.find(".multiListSelect2"),f.append(i)},c.getSelectedValues=function(){h=[],i.find("option:selected").each(function(b){var c={id:a(this).attr("data-multiList-id"),name:a(this).text(),weight:a(this).attr("data-order"),value:a(this).val()};k.itemImage&&(c.image=a(this).attr("data-image")),h.push(c)}),i.find("option").not("option:selected").attr("data-order",parseInt(h.length+1)),h.sort(function(a,b){return parseInt(a.weight)-parseInt(b.weight)})},c.getMultilistItem=function(b){return a.grep(h,function(a){return a.id==b})[0]},c.execNestable=function(){e.find(".dd-list").html(""),h.length>0&&(a.each(h,function(b,c){var d='<li class="dd-item" data-id="'+c.id+'">';d+='<div class="unselectNestable">X</div>',k.itemActions&&(d+='<ul class="dd-multiListActions clearfix">',a.each(k.itemActions,function(a,b){d+='<li class="dd-multiList-action-'+b.id+'" data-action-id="'+b.id+'">',d+=b.html,d+="</li>"}),d+="</ul>"),d+='<div class="dd-handle">',d+='<div class="dd-multiListIcon">',k.icon&&(d+=k.icon),d+="</div>",k.itemImage&&(d+='<div class="multiListImage"><img class="img-responsive" src="'+c.image+'"></div>'),d+='<div class="multiListText">'+c.name+"</div>",d+="</div>",d+="</li>",e.find(".dd-list").append(d),i.find('option[data-multiList-id="'+c.id+'"]').attr("data-order",b)}),e.find(".unselectNestable").on("click",function(b){var c=a(this).parent().attr("data-id");i.find('option[data-multiList-id="'+c+'"]').attr("selected",!1),a(this).parent().remove(),b.stopPropagation()}));var b="";k.itemImage&&(b="multiListImages");var c;c="V"===k.orientation?g+" multiListDragel "+b:g+" multiListDragel "+b+" multiList"+k.orientation,e.nestable({dragClass:c,maxDepth:1,group:g,callback:function(b,c){var d=e.nestable("serialize");a.each(d,function(a,b){i.find('option[data-multiList-id="'+b.id+'"]').attr("data-order",a)})}})},c.execSelect2=function(){i.select2({tags:"true",placeholder:k.placeholder})},c.reloadMultiList=function(){c.initOptionsValues(),c.getSelectedValues(),c.execNestable(),c.reloadBinds()},c.multiListBinds=function(){i.on("change",function(a){c.reloadMultiList()}),c.reloadBinds()},c.reloadBinds=function(){k.itemActions&&e.find(".dd-multiListActions li").on("click",function(b){var d=a(b.currentTarget).attr("data-action-id");a.each(k.itemActions,function(e,f){d===f.id&&f.action(c.getMultilistItem(a(b.currentTarget).closest("li.dd-item").attr("data-id")),i)})})},c.init=function(){"undefined"!=typeof multiListCount?multiListCount++:multiListCount=1,g="multiListId-"+multiListCount,c.initOptionsValues(),c.getSelectedValues(),c.createInterface(),c.execSelect2(),c.execNestable(),c.multiListBinds()},c.init()},a.fn.multiMultiList=function(b){a(this).each(function(c){a(this).multiList(b)})}}(jQuery);
